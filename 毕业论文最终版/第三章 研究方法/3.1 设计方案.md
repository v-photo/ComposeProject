## 3.1 设计方案

### 3.1.1 框架总体思路：数据驱动与物理约束的双层自适应路径

本研究旨在解决复杂辐射场重建中“计算效率”与“物理可信度”难以兼顾的难题。针对辐射防护与环境监测中常见的两类数据形态——探测点分布较均匀的理想情形，以及受屏蔽或场地限制导致的稀疏、聚集情形——单一的算法往往难以同时满足精度与速度的要求。为此，本章提出了一种“双层自适应”混合计算框架，其核心思想遵循“先选择最优路径，再进行精细化提升”的逻辑，目标是在分钟级的计算时间内完成高可信度的三维剂量场重建。

框架的运行逻辑分为两个层次：

1.  **上层：路径自适应选择（Path Selection）**
    系统首先对输入数据的空间分布特征进行统计分析。
    *   当观测数据分布较为均匀、能够充分表征空间场特征时，系统优先选择**数据驱动路径（Kriging）**，利用空间自相关性以极低的计算代价快速生成插值结果。
    *   当观测数据呈现明显的聚集特征、或存在大面积信息盲区时，系统自动切换至**物理约束路径（PINN）**，引入辐射传输控制方程作为硬约束，保证在无数据区域的重建结果符合物理规律，避免出现非物理的数值震荡。

2.  **下层：局部精细化修正（Refinement）**
    若系统进入物理约束路径，将启动精细化修正机制。针对传统 PINN 在稀疏数据下收敛慢、精度低的问题，本研究引入克里金（Kriging）算法作为低成本的**“残差分布估计器”**。该机制在训练过程中动态估计全域的误差分布（即残差场），并指导采样器优先在潜在的高误差区域生成新的计算节点（Collocation Points）。通过这种**“评估-聚焦”**的迭代过程，将有限的计算资源集中投放于最需要优化的区域，从而实现重建精度的自适应提升。

### 3.1.2 核心运行模式

为了满足从快速现场巡检到高精度离线建模等不同场景的计算需求，本框架设计了五种标准化的运行模式。这些模式覆盖了从完全自动化到高度定制化的应用光谱，用户可根据实际任务的精度要求与时间预算进行选择。

1.  **智能自动选择模式 (Auto-Selection Mode)**
    这是系统的默认模式，体现了“自动化”的核心设计理念。该模式不预设固定的算法路径，而是启动内置的**智能模型选择器**（详见3.2节）。系统首先计算输入数据的空间均匀性指标（$CV_{NN}$），根据判据自动决策是启用轻量级的 Kriging 插值引擎还是启动深度的 PINN 物理引擎。该模式旨在为非专家用户提供“开箱即用”的最优解，在保证可靠性的前提下尽可能降低计算耗时。

2.  **纯数据驱动模式 (Pure Data-Driven Mode)**
    该模式强制系统仅使用基于 GPU 加速的克里金（Kriging）模块。它适用于数据量充足、分布规范且满足平稳性假设的标准测量场景。其核心优势在于极致的计算速度（通常为毫秒级），适合对实时性要求极高的在线监测任务。

3.  **纯物理约束模式 (Pure Physics-Informed Mode)**
    该模式强制系统仅使用物理信息神经网络（PINN）。它适用于数据极度稀缺、分布严重不均或几何边界极其复杂的场景。在此模式下，算法主要依靠辐射传输方程的泛化能力进行全场推演，利用物理规律填补数据盲区，确保重建结果的物理一致性。

4.  **完整自适应实验模式 (Full Adaptive Experiment Mode)**
    这是本研究提出的最高精度模式，集成了框架的所有高级特性。它引入了类似生物进化的**多周期循环机制**：
    *   **循环迭代**：训练过程被划分为多个周期，每个周期包含**“训练-评估-重采样”**三个闭环步骤。
    *   **动态探索**：随着周期的推进，采样策略从“全局广撒网”逐渐转向“局部精修”，探索率参数随时间自动衰减。
    *   **数据注入**：支持在特定周期向训练集中注入补充观测数据，模拟实际监测中的追加测量，打破模型可能陷入的局部最优。
    *   **保护机制**：内置早停（Early Stopping）与回退（Rollback）机制，若监测到模型性能停滞或震荡，自动回滚至当前周期的最佳状态，确保优化方向始终正确。

### 3.1.3 评价指标与对照基线

为了客观量化本框架的性能，本研究确立了统一的评价指标，并针对两条主要技术路径（物理约束路径与数据驱动路径）分别设置了公平的对照基线。

**1. 评价指标：平均相对误差 (MRE)**
本研究采用平均相对误差作为衡量重建精度的核心指标，它直观地反映了重建剂量场与真实物理场之间的整体偏差程度。
$$ \text{MRE} = \frac{1}{N} \sum_{i=1}^{N} \left| \frac{y_{\text{pred}}^{(i)} - y_{\text{true}}^{(i)}}{y_{\text{true}}^{(i)}} \right| $$
其中，$y_{\text{pred}}$ 为模型预测剂量，$y_{\text{true}}$ 为蒙特卡罗模拟得到的真实剂量基准。该指标越低，说明重建结果越接近物理真实。

**2. PINN 路径的对照基线：固定采样模型 (Baseline-Fixed)**
验证自适应采样策略有效性的关键，在于建立一个仅改变“采样方式”的对照组。本研究定义的 **PINN 基线模型** 遵循严格的“控制变量法”原则：
*   **网络结构一致**：与自适应模型采用完全相同的神经网络架构（层数、神经元数、激活函数）。
*   **物理参数一致**：使用相同的物理方程系数（源项、吸收系数等）。
*   **计算预算一致**：保持相同的总训练迭代轮数（Epochs）和总采样点数量（配点数）。
*   **数据来源同源**：使用完全相同的初始训练集和验证集。

**唯一区别**在于：自适应模型在训练过程中会根据残差分布动态调整配点位置；而基线模型则采用**固定随机采样**策略，即计算点在初始化时一次性随机生成并保持不变。通过对比两者在同一坐标系下的 MRE 收敛曲线，可以精准地剥离并量化自适应策略带来的精度增益。

**3. Kriging 路径的对照基线：CPU 串行实现 (Baseline-CPU)**
验证 GPU 加速模块有效性的关键，在于对比其相对于传统 CPU 实现的加速比与数值一致性。本研究选择成熟的 Python 开源库（如 PyKrige 或 Scikit-learn 的实现）作为 **CPU 基线模型**。
*   **算法内核一致**：使用完全相同的变异函数模型（如 Exponential Model）及参数配置（Nugget, Sill, Range）。
*   **数学逻辑一致**：执行完全相同的协方差矩阵构建与线性方程组求解步骤。
*   **任务负载一致**：处理完全相同的观测数据集和待预测网格点。

**评价重点**在于：
*   **加速比 (Speedup Ratio)**：对比 GPU 并行计算与 CPU 串行计算的耗时差异。
*   **数值等价性**：验证 GPU 单精度/双精度计算结果与 CPU 双精度基准之间的偏差，确保加速未引入不可接受的数值误差。
