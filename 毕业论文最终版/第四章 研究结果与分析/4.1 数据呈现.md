## 4.1 数据呈现与实验设计

本章旨在全面、客观地评估本研究提出的"双层自适应PINN-Kriging混合计算框架"的综合性能。为了实现这一目标，我们必须构建具有针对性的测试基准，并建立完整的实验评估体系。本节将详细介绍实验平台配置、数值模拟方法、测试场景设计以及评估指标体系，为后续 `4.2` 至 `4.5` 节的深入分析奠定坚实基础。

### 4.1.1 实验平台与硬件配置

为确保实验结果的可重现性和可比性，本研究在统一的硬件平台上进行所有测试。具体配置如下：

- **CPU**：Intel Core i5-12490F 处理器（6核12线程，基频3.0GHz）
- **GPU**：NVIDIA GeForce RTX 2080Ti（4352个CUDA核心，11GB GDDR6显存）
- **内存**：32GB DDR4 RAM（2×16GB，频率3192MHz）
- **操作系统**：Ubuntu 20.04 LTS
- **编程环境**：CUDA 11.8，Python 3.8，CuPy 11.0

该配置代表了当前主流的科学计算平台，既能满足大规模并行计算的需求，又具有良好的成本效益比，使研究结果具有广泛的实用价值。

### 4.1.2 模拟方法：基于蒙特卡罗的"真实物理场"构建

为获得精确且可靠的三维辐射剂量场分布，我们采用国际上广泛认可的蒙特卡罗粒子输运模拟程序 **FLUKA** [1] 进行正向建模。蒙特卡罗方法被誉为辐射输运模拟的"金标准"，能够精确模拟粒子在复杂几何和材料中的输运过程。

为提高计算效率，我们采用了FLUKA内置的减方差技术（Variance Reduction Techniques）[2]和多线程计算技术，主要包括：

**权重窗技术**：根据距离源点的远近设置不同的统计权重。

**粒子数控制**：总输运粒子数设为5×10^8（多线程，5个线程一个线程运行1×10^8），运行轮数设置为5轮，确保统计可靠性。

**权重窗技术详述**：权重窗（Weight Windows）是蒙特卡罗输运计算中最重要的减方差技术之一。在辐射场重建问题中，由于γ射线在传播过程中遵循距离平方反比衰减规律，远离源点的区域粒子通量密度极低，导致统计误差显著增大。权重窗技术通过在空间中建立分层的重要性区域，为不同位置的粒子分配不同的统计权重：距离源点近的区域（如0-0.5m范围）设置较低权重（权重=1），而距离源点远的区域（如3-5m范围）设置较高权重（权重=125）。当粒子进入高重要性区域时，系统会自动进行"分裂"操作，将一个粒子分裂为多个具有较小权重的粒子；相反，在低重要性区域则进行"俄罗斯轮盘赌"操作，以一定概率终止粒子输运。这种自适应的统计权重分配策略显著提高了远场区域的统计精度，同时避免了计算资源的浪费。

**多线程并行计算技术详述**：考虑到单线程蒙特卡罗模拟的计算时间较长，本研究采用了FLUKA内置的多线程并行计算功能。具体实现方案为：将总计5×10^8个粒子平均分配给5个并行线程，每个线程独立处理1×10^8个粒子的输运过程。每个线程维护独立的随机数种子和统计累加器，避免了线程间的数据竞争问题。在所有线程完成计算后，系统自动将各线程的统计结果进行加权平均，得到最终的剂量率分布。为进一步提高统计可靠性，整个并行计算过程重复执行5轮，最终结果为5轮计算的平均值。这种多线程并行策略在保证计算精度的前提下，将单次模拟的计算时间从约48小时缩短至约10小时，大幅提升了研究效率。

综合应用上述技术，在保证模拟结果物理真实性的前提下，将计算时间缩短了约2个数量级，同时获得了统计学上可靠的三维辐射场分布数据。

### 4.1.3 靶向性模拟场景构建

为了系统性地探究不同算法的性能边界，并验证本框架的自适应决策能力，我们设计了以下两个靶向性明确的模拟场景。

#### 4.1.3.1 模拟场景一：单源无屏蔽（数据驱动算法理想场景）

该场景旨在构建一个物理过程相对简单、空间相关性强的辐射场，作为**检验数据驱动方法（如Kriging）性能上限的理想基准**。
- **几何与环境**：构建一个尺寸为 $5m \times 5m \times 5m$ 的空气立方体空间，空间网格划分为 $100 \times 100 \times 100$，共计1×10^6个网格单元，每个单元尺寸为 $5cm \times 5cm \times 5cm$。
- **辐射源**：在空间坐标 `(0, 0, 0)` 处放置一个点状放射源，发射能量为 $0.3 MeV$ 的 $\gamma$ 射线，源活度为 $10^{11} Bq$。
- **偏倚策略**：采用四层权重窗设置，距离源点越远权重越高（权重分别为1、5、25、125），以提高远场统计精度。
- **数据特性与采样**：该场景的辐射场以源为中心呈规律性衰减，空间相关性强，信息连续且覆盖全场。我们对此场景采用 **均匀随机采样** 策略，模拟探测器被理想化地均匀部署的工况。

#### 4.1.3.2 模拟场景二：多源带屏蔽（物理驱动算法优势场景）

该场景旨在模拟一个更接近真实工业环境的复杂辐射场，其特性恰好构成对传统数据驱动方法的严峻挑战。
- **几何与环境**：构建一个尺寸为 $20m \times 6m \times 8m$ 的矩形空间，由30cm厚混凝土墙包围，内部包含：
  - 圆柱形铅容器（厚度5cm，底面中心位于(9.7m, 2.7m, 0m)）
  - 混凝土墙（厚度50cm，位于15.0m-15.5m范围）
  - 铝门（2m×1m×0.05m，安装在混凝土墙上）
- **辐射源**：设置两个不同位置、不同能量的 $\gamma$ 射线源：
  - 源1：位于(9.7m, 2.7m, 0.2m)，发射3 MeV γ射线，活度 $10^9 Bq$
  - 源2：位于(19.7m, 5.7m, 4.3m)，发射0.8 MeV γ射线，活度 $10^9 Bq$
- **数据特性与采样**：多源和复杂屏蔽体的存在，导致其辐射场分布极不均匀，存在剂量率的"断崖式"变化和广阔的"信息盲区"。我们对此场景采用 **聚集性采样** 策略，模拟探测器只能被放置在少数可达区域的现实约束。

### 4.1.4 评估指标体系与实验设计

为确保实验结果的科学性和可比性，本研究建立了多维度的评估指标体系，涵盖精度、效率和智能性三个核心维度：

#### 4.1.4.1 精度评估指标

**平均相对误差（Mean Relative Error, MRE）**作为核心精度评估指标：
$$\text{MRE} = \frac{1}{m}\sum_{i=1}^{m}\left|\frac{\hat{Z}(x_i) - Z_{true}(x_i)}{Z_{true}(x_i)}\right| \times 100\%$$

其中，$\hat{Z}(x_i)$为算法预测值，$Z_{true}(x_i)$为FLUKA模拟的真实值，$m$为预测点总数。

**GPU与CPU计算一致性**：通过对比GPU加速版本与CPU基准版本的计算结果，验证并行化实现的精度保持能力，要求相对差异小于0.01%。

#### 4.1.4.2 效率评估指标

**计算耗时**：记录各算法的实际运行时间（秒），包括数据预处理、模型训练/拟合、预测计算等全流程时间。

**加速比（Speedup）**：定义为CPU基准时间与GPU并行时间的比值：
$$\text{Speedup} = \frac{T_{CPU}}{T_{GPU}}$$

**可扩展性分析**：通过变化已知点数量（343-4096点）和预测点数量（10^5-10^7点），系统性评估算法的计算规模适应性。

#### 4.1.4.3 智能性评估指标

**决策准确性**：智能模型选择器的决策是否与预期一致（均匀数据选择Kriging，聚集数据选择PINN）。

**自适应性能提升**：混合框架相对于单一算法的性能改善程度，通过精度-效率综合评分量化。

#### 4.1.4.4 实验设计原则

基于上述指标体系，本章实验遵循以下设计原则：

1. **对比性**：每个场景下同时测试GPU-Kriging、PINN和混合框架，确保横向可比性
2. **梯度性**：通过逐步增加数据复杂度和计算规模，揭示算法性能变化规律  
3. **重现性**：所有实验使用相同硬件平台和软件版本，确保结果可重现
4. **针对性**：两个场景分别针对不同算法的优势场景设计，充分验证框架的自适应能力

### 4.1.5 章节分析框架概述

基于上述实验设计，本章后续分析将按以下逻辑展开：

- **4.2节**：独立评估GPU-Kriging模块，验证其在理想场景下的高效性和复杂场景下的局限性
- **4.3节**：独立评估PINN算法，展示其对数据分布的鲁棒性以及计算成本特征
- **4.4节**：综合评估混合框架的智能选择性能，重点验证智能选择器的决策准确性
- **4.5节**：验证自适应采样机制的有效性，展示Kriging引导采样相对于传统策略的优势
- **4.6节**：通过可视化分析，直观展示不同方法的重建效果差异，提供定性验证

这一渐进式的分析框架将全面展现本研究提出的"双层自适应PINN-Kriging混合计算框架"的技术优势和应用价值。

### 4.1.6 参考文献

[1] A. Ferrari, P. R. Sala, A. Fasso, and J. Ranft, "FLUKA: a multi-particle transport code," CERN-2005-10, INFN/TC\_05/11, SLAC-R-773, 2005.

[2] J. C. Wagner, "A tutorial on the use of variance-reduction techniques with Monte Carlo radiation transport codes," Oak Ridge National Lab., TN (United States), 2016.
