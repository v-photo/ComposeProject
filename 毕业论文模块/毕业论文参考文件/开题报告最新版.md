# 中国原子能科学研究院硕士研究生学位论文开题报告

# 三维辐射场重建算法的GPU优化与加速研究：点核积分法与克里金法的应用

姓名： 肖宁标

指导老师： 骆志平

单位：核安全与环境工程技术研究所

专业名称：辐射防护与环境保护

2024年10月9日

# 目录

(黑体 3 号字, 段前 19.85 磅, 段后 0 ; 目录题目与条目之间空两行)

# 第一章 课题来源及研究目的和意义

1.1  
1.2.

# ··

# 第二章 国内外研究现状及分析

2.1  
2.2

# ··

# 第三章主要研究内容

3.1  
3.2.

# ··

# 第四章 研究方案及进度安排

4.1  
4.2.

# ··

# 第五章预期目标及创新点

5.1. \*  
5.2.

# 第六章可能遇到的困难及解决措施

# ··

# 第七章 为完成课题已具备和所需要的条件及经费

# ··

# 第八章 主要参考文献

# 课题来源及研究目的和意义

# 1.1 课题来源

三维辐射场的精确建模与重构技术在核能、辐射防护、核医学等领域有着重要应用。随着核技术的发展，放射性物质监测与辐射场评估的需求逐步增加然而，传统的计算方法，如正向建模中的点核积分法和反向重构中的克里金法计算复杂度较高，尤其在大规模数据处理和高精度要求下，计算时间显著增加难以满足实时监测和评估的需求。

近年来，随着GPU（图形处理单元）计算技术的进步，特别是在高性能计算领域的成功应用，国内外研究者开始探索将GPU加速技术引入辐射场建模与重构中，以提高计算效率和加快响应速度。虽然已有部分研究在这方面取得了进展，但大多数工作仍局限于特定算法或应用场景，缺乏对核心算法的系统化加速优化。因此，本课题在总结国内外研究成果的基础上，结合GPU技术，对三维辐射场的核心算法进行深入优化，加速正向建模中的点核积分法和反向重构中的克里金法，提升计算效率。

# 1.2 研究目的与意义

本课题的研究目的在于通过引入GPU加速技术，优化三维辐射场的正向建模与反向重构方法，特别是针对点核积分法和克里金法，解决当前计算过程中存在的效率瓶颈，提升复杂场景下的计算性能，为辐射场的实时建模与高效重构提供技术支持。

研究的意义在于，通过对核心算法的加速与优化，不仅能够显著减少计算时间，提升系统的实时响应能力，满足核辐射监测和辐射防护等领域的实际应用需求，还可以推动GPU加速技术在辐射场分析中的广泛应用，提升我国在该领域的技术水平。同时，研究成果将为相关领域的学术研究和工业应用提供新的技术路径，具有重要的理论和实践意义。

# 国内外研究现状及分析

# 2.1 研究概况

# 2.1.1辐射场重建算法类型

在辐射场重建算法的研究中，根据先验信息的不同可以分为两种：正向建模算法和反向重构算法。

正向建模是指根据已知的源项条件和传输介质参数，模拟计算出理论辐射场分布，其主要包含由蒙特卡洛方法，离散纵坐标法和点核积分方法等。而反向重构则是利用监测获得的辐射数据，通过算法重构出实际辐射场分布，其主要包含线性插值法，反距离加权法，克里金算法以及有限元法等。

![](images/089d8363bc467e78235794379910a2b070d066fbf5af2c31a56da49aa51822f0.jpg)  
(1) 正向建模（蒙特卡洛方法）  
(2) 反向重构（克里金算法）

![](images/797b438d1b9ce80a4ce54d6b8f3501da9fa35c5920f633a6d8677555ba6ff07e.jpg)

# 2.1.2辐射场重建算法的GPU加速

# (1) GPU 介绍

GPU最初是为图形渲染而设计的，用于加速计算机图形的生成和显示。然而，由于其并行计算的特性，GPU逐渐被应用于通用计算领域。与传统的中央处理器（Central Processing Unit，CPU）相比，GPU具有数百个甚至上千个小型处理单元，称为流处理器（Streaming Processor），可以同时执行大量相似的计算任务。

# (2) GPU 加速算法原理

GPU加速可以使用各种编程模型，如CUDA(适用于NVIDIA GPU)和OpenCL(多平台)。这些编程模型提供了一组编程API和工具，允许开发者编写可在GPU上执行的代码。本文介绍和使用的模型为英伟达的CUDA模型。

在 CUDA 编程中，GPU 线程模型由线程 (thread)、线程块 (block) 和网格 (grid) 组成，它们分别由 GPU 硬件结构上的流处理器 (streaming processor)、多个流处理器组成的多处理器 (Multiprocessor) 以及所有的多处理器组成的整体进行执行和操作。线程块是 GPU 中最小的并行执行单元，其包含多个线程，并以一个二维或三维的结构进行组织。

![](images/32fc1e5d1d111f9692345d6a772b35b7a4a39d405a0d396cdf32c07511641e52.jpg)

![](images/e1bd805172c8161b97b9d2260d584ab383c2cb9fe2da32b04a322cc41c1d02a1.jpg)

![](images/b0d53dde8c958624b8c5501180be7e6599607ec8df1b1dfb0090b96641800436.jpg)

# 2.2 国内外研究现状

# 2.2.1 蒙特卡洛方法的GPU加速

在三维辐射场的模拟与重构中，蒙特卡洛方法作为正向建模的经典工具，得到了广泛应用。由于其对复杂几何、散射和吸收现象的准确模拟，蒙特卡洛方法在辐射场计算中占据了重要地位。然而，由于其庞大的计算量，如何提升蒙特卡洛方法的计算效率成为近年来研究的重点。随着GPU并行计算等技术的发展，蒙特卡洛方法在辐射场建模与重构中的计算速度得到了显著提升。例如，Lennart Jahnke等人提出了GMC（GPU Monte Carlo），实现了基于Geant4的蒙特卡洛剂量计算，通过GPU加速，平均加速比达到4860倍，显著提升了计算效率。Smith等人通过GPU加速蒙特卡洛方法，有效提升了质子治疗中正电

子发射同位素的模拟效率，为PET影像验证提供了更快速的计算手段。Jones等人提出了基于GPU的轨迹重复算法，用于质子放射治疗剂量计算，结果显示在保持与传统蒙特卡洛模拟一致的计算精度的同时，计算速度提高了约40倍，显著加速了剂量分布的评估过程。Wei-Guang Li等人使用了最新型的GPU加速框架Taichi加速了蒙卡方法，得到了大约5800倍的加速比，相比CUDA和OpenCL等穿透加速框架，代码量减少了10倍以上。基于此类成功经验，如何优化和加速辐射场模拟与重构的算法成为该领域研究的重要方向。

虽然蒙特卡洛方法的加速研究丰富，但其计算成本依然较高，尤其在需要实时响应或大规模场景下。相比之下，点核积分法因其结构简单、效率高，具备在特定场景下快速评估辐射场分布的潜力。

# 2.2.2点核积分法的GPU加速

点核积分法通过将辐射源离散为多个点源，计算其在介质中的辐射贡献。然而，关于该方法的加速研究较为有限。目前，Zhang等人[2]开发了一种基于GPU的点核积分法代码GPPK，用于辐射控制区内伽马剂量率的虚拟模拟，结

果表明计算速度提高了约20倍，大幅提升了模拟效率。这是迄今为止为数不多的关于点核积分法加速的研究，表明该方法仍具备进一步发展的潜力。

# 2.2.3 离散纵坐标法的GPU加速

离散纵坐标属于粒子输运方程数值求解方法中的确定论方法，其通过建立一个数学模型，用一个或一组确定的数学物理方程来表示，然后采用数学方法对这些数学物理方程求出一个精确解或近似解。丁林杰等人[3]针对ASCI Sweep3D应用进行了GPU加速的研究与开发。Sweep3D是一个三维粒子输运程序，用于评估高性能并行架构。研究团队通过将Sweep3D程序重构为一系列组件，并利用P-COM2组件化编译器，实现了代码的自动化组合，以适应不同的执行环境和问题实例。

丁林杰等人的研究中，通过将Sweep3D的关键计算部分转移到GPU上执行，充分利用了GPU的并行处理能力。GPU的并行架构特别适合于Sweep3D这类具有大量数据并行性的应用。在他们的研究中，通过优化算法和数据传输策略，实现了对Sweep3D程序的显著加速。具体来说，他们通过组件化开发方法，将

Sweep3D 程序重构为一组组件，并使用 P-COM2 组件化编译器自动组合这些组件，以适应不同的执行环境和问题实例。这种方法不仅提高了代码的可维护性和可扩展性，还使得针对特定执行环境的优化变得更加容易。

在性能测试方面，丁林杰等人的研究表明，通过GPU加速，Sweep3D程序在不同问题规模和处理器配置下均获得了显著的性能提升。例如，在 $100\times 100\times 100$  和  $200\times 200\times 200$  的问题规模下，使用1个、2个、4个和8个处理器时，组件化代码与原始代码相比，在速度提升、效率和可扩展性方面都有显著的改进。具体数据包括，在  $100\times 100\times 100$  问题规模下，使用2个处理器时，组件化代码的速度比原始代码快了约2.02倍；而在  $200\times 200\times 200$  问题规模下，使用4个处理器时，组件化代码的速度比原始代码快了约3.97倍。这些数据展示了组件化开发和GPU加速在提高Sweep3D程序性能方面的有效性。

此外，丁林杰等人还探讨了同步与异步通信对性能的影响。他们发现，在 $200\times 200\times 200$  问题规模下，异步通信模式下的组件化代码在所有情况下都比原

始代码快。异步通信通过双缓冲发送/接收消息来重叠发送和接收对，以及与当前块的工作，从而减少了通信开销，提高了性能。

Dmitry S. Efremenko 等人[4]在其研究中开发了一种基于离散方向法（Discrete Ordinate Method, DOM）的辐射传输模型（RTM），并利用 CUDA 框架对其进行了 GPU 加速。这项工作的核心目标是设计适用于 GPU 架构的 RTM 代码，并探索 GPU 计算相对于传统基于多核 CPU 的并行化技术在性能提升方面的潜在优势。研究团队通过将原始的 CPU 代码重新设计，使用 NVIDIA 的 Compute Unified Device Architecture（CUDA）进行 GPU 内存管理，以适应 GPU 的寄存器限制，从而实现了 RTM 的加速。

在性能测试中，Efremenko等人发现，使用GPU可以实现对多流RTM的20倍至40倍加速，以及对双流RTM的50倍加速。这些加速比是相对于原始的单线程CPU代码而言的。为了减少CPU/GPU之间的通信开销，研究者利用了异步数据传输技术。此外，通过在CPU和GPU之间分配工作负载，实现了计算的重叠，进一步提升了性能。

研究中还提到了多核CPU和GPU实现的RTM的性能对比。在处理Sentinel5 Precursor、Sentinel4和Sentinel5平台上的欧洲大气传感器下一代数据时，需要快速的检索算法来实时处理Sentinel数据。在从卫星传感器检索微量气体和云信息的过程中，RTM模拟是最耗时的部分。Efremenko等人的研究显示，通过使用OpenMP进行并行化，可以在多CPU机器上实现  $70\%$  至  $80\%$  的理论最大加速比。而通过使用为多核系统优化的数学库，如Intel开发的Math KernelLibrary(MKL)，也可以在多核CPU上实现近两倍的加速。

此外，研究还探讨了GPU在执行矩阵操作时的性能提升。对于大型矩阵操作，GPU计算显示出显著的加速比，但对于小秩矩阵，GPU计算并不会产生显著的加速。研究中提到，对于  $8000 \times 8000$  大小的矩阵，GPU计算仅比CPU计算快2至5倍，而对于小于  $512 \times 512$  的矩阵，GPU和CPU的性能相当。

Tom Deakin 等人[5]使用 GPU 并行框架 OpenCL 对离散纵坐标程序 SNAP mini 进行加速，与多核 CPU 加速相比，加速倍数达到了 2.5 到 4 倍。

# 2.2.4反距离加权法的GPU加速

反距离权重插值法(inverse distance weighting，IDW)是基于Tobler定理(地理第一定律)提出的一种确定性插值方法，其核心思想为插值函数  $Z(x, y)$  是各数据的线性加权组合，其影响权重与距离相关。Ren-Yao Wu等人[6]在其研究中提出了一种新颖且快速的三维重构方法，特别适用于康普顿相机在放射性成像中的应用。该方法基于锥面采样反投影法（CSS-BP-SC），通过图形处理单元（GPU）加速，显著提升了康普顿相机的成像应用。研究中，通过蒙特卡洛（MC）模拟和实验验证了该方法的有效性，结果显示，CSS-BP-SC方法在成像结果上与传统重建算法相当，但在速度上提升了664倍以上。

在模拟研究中，使用CSS-BP-SC方法的LM-MLEM迭代重建算法在处理两个点源模拟数据时，其全宽半高（FWHM）值沿x轴为  $15.02\mathrm{mm}$ ，沿y轴为 $22.46\mathrm{mm}$ ，沿z轴为  $22.46\mathrm{mm}$ ，而重建时间为1223.3秒。相比之下，传统的SBP方法的FWHM值分别为  $15.53\mathrm{mm}$ 、 $22.16\mathrm{mm}$  和  $22.42\mathrm{mm}$ ，重建时间为16046.5秒。这表明CSS-BP-SC方法在保持成像质量的同时，大大缩短了重建时间。

在对小鼠模型的MC模拟和实验中，CSS-BP-SC方法同样展现出了优异的性能。在模拟中，使用CSS-BP-SC方法的LM-MLEM迭代重建算法的活性恢复系数（ARC）对于大脑和膀胱分别为0.240和0.295，与SBP方法的结果相近。实验中，CSS-BP-SC方法的LM-MLEM迭代重建算法的ARC值对于大脑和膀胱分别为0.047和0.035，虽然低于模拟结果，但仍然显示出了该方法在实际应用中的潜力。

此外，研究还表明，通过GPU加速，CSS-BP-SC方法的LM-MLEM迭代重建算法在小鼠模型实验中的重建速度比传统的SBP方法快了664倍以上，具体时间为16.2秒，而SBP方法需要10750.7秒。这一显著的速度提升，使得该方法在临床应用中具有重要的实用价值，尤其是在需要快速反馈的手术肿瘤定位和图像引导干预等场景中。

# 2.2.5 克里金法的GPU加速

克里金法作为一种广泛应用于空间插值的算法，在辐射场的反向重构中也展现出巨大潜力。克里金法通过利用已知观测数据对未知区域进行预测，具有

较高的精度。然而，在辐射场重构领域，目前基本没有关于克里金法加速的文献报道。尽管如此，克里金法在其他领域，特别是地质学中的应用，已经有了显著的加速成果。Tangpei Cheng等人[7]提出了一种在NVIDIA CUDA平台上加速通用克里金算法的高效并行方案，通过优化内存传输和计算步骤，实现了近18倍的加速，显著提升了地质应用中的插值计算效率。Yuheng Zhang等人[8]提出了一种基于OpenCL框架的集成了CPU和GPU计算资源的并行时空克里金算法，相对于普通克里金算法，速度提高了3.23倍。Song Liu等人[9]分别对单精度数据和双精度数据使用GPU加速的克里金算法，测试得到对单精度数据GPU可加速大概600倍，对双精度数据GPU可加速大概350倍。

# 2.2.5 现状总结

尽管点核积分法和克里金法在辐射场模拟与重构领域的加速研究仍然较为稀缺，但借鉴其他领域的成功经验，结合GPU等并行计算技术，可以为这两种算法的在辐射场重构领域的加速优化提供新的思路。未来的研究可以通过在大规模三维辐射场数据处理中的应用，进一步验证这些算法的可行性和有效性。

# 主要研究内容

# 3.1 算法加速的两种主要方式

对各种算法的加速一般在大体上可分为两类：一种是在对对应算法与相关知识了解非常透彻的基础下，对算法本身原理和步骤进行底层改写。一种是在对算法基本步骤了解的基础下，直接使用通用并行化工具对其进行加速。

比如对于蒙特卡洛算法，第一种加速方式可以通过深入理解算法的随机采样和轨迹跟踪过程，对其进行优化。具体而言，可以在抽样过程中引入自适应采样技术，在高差异区域增加抽样密度，在均匀区域减少抽样，以此提高整体计算效率，例如FLUKA软件的偏置(biasing)技术。同时，基于对模拟过程的深入理解，还可以对不同的核物理过程进行针对性优化，减少不必要的粒子跟踪和无效计算，从而提高蒙特卡洛算法的精度和效率。这种方法仅对当前加速算法有效，所掌握知识无法直接应用到下一个算法，同时需要加速人员对该算法的底层原理了解十分透彻。

第二种加速方式则是利用现有的并行化工具对蒙特卡洛算法进行加速。例如，使用GPU并行计算框架（如CUDA或OpenCL）将大量粒子轨迹的模拟任务分配到GPU的多处理器中，通过并行计算大幅缩短运行时间。在这种情况下，算法的核心逻辑保持不变，而是通过并行化技术对大量独立任务进行加速。这种方式能够充分发挥现代计算硬件的性能优势，在不大幅修改算法的情况下实现较高的加速比。这种方法对所有算法加速具有通用性，但是对不同算法的加速效果有所不同，同时对加速人员算法调试技能与并行化知识要求较高。

对于点核积分和克里金插值等算法，加速方式也大致分为这两类。在深入理解点核积分的原理基础上，可以针对积分中的核函数或卷积操作进行底层优化，如采用更高效的数值积分方法或利用空间分割技术减少不必要的计算量。而在第二种加速方式中，使用通用的并行化工具，如CPU多线程并行或GPU加速，能够直接对点核积分和插值过程进行并行处理，大幅提升计算效率。

相比于通过对算法本身进行底层优化的第一种方法，第二种加速方法的最大优势在于不需要对算法的原理和内部结构有透彻的理解。研究人员可以利用

现有的算法分析工具，通过时间调试（Profiling）技术，找到整个算法中最耗时的部分，进而将其作为优化的重点。这极大降低了进入复杂算法优化的学习门槛，使得更多研究人员能够快速应用并行加速技术。本文采取的算法优化方法即为第二种。

# 3.2 优化基本流程

要采用第二种方法对算法进行优化，有以下几个基本流程：

1）算法基本步骤分析  
2）算法复杂度分析与时间调试  
3）算法并行化处理  
4）并行化算法准确度与加速效果检验

# 研究方案及进展

# 4.1 研究方案

根据第3章所述研究内容，具体研究方案如下图所示：

![](images/927336eefd0804abffe1c2950a982229e2ef0defd81f9fe9e24f8f5e87d219e3.jpg)

# 4.2 研究进展

<table><tr><td colspan="2"></td><td>克里金算法的GPU加速</td><td>点核积分的GPU加速</td></tr><tr><td rowspan="2">算法步骤分析</td><td>算法原理分析</td><td>✓</td><td>✓</td></tr><tr><td>原理转换步骤</td><td>✓</td><td>×</td></tr><tr><td rowspan="2">算法复杂度分析与时间调试</td><td>算法时间复杂度分析</td><td>✓</td><td>×</td></tr><tr><td>时间调试</td><td>✓</td><td>✓</td></tr><tr><td rowspan="3">算法并行化处理</td><td>并行内容向量化处理</td><td>✓</td><td>×</td></tr><tr><td>对矩阵运算进行GPU加速</td><td>✓</td><td>×</td></tr><tr><td>平衡耗时操作</td><td>✓</td><td>×</td></tr><tr><td rowspan="2">并行化算法准确度与加速效果验证</td><td>蒙卡模拟</td><td>✓</td><td>×</td></tr><tr><td>测试结果准确度和方差</td><td>✓</td><td>×</td></tr><tr><td colspan="2">工程化</td><td>×</td><td>×</td></tr></table>

# 预期目标及创新点

# 5.1 预期目标

本课题拟开发一套基于GPU加速的点核积分法与克里金法的三维辐射场重构算

法，旨在显著提升算法的计算效率。通过整合高效的并行计算技术与算法优化，

最终目标是实现大规模辐射场数据的快速处理。预期算法达到的技术指标为：

(1) 剂量率场重构误差：重构平均相对误差不高于  $50\%$  
(2) 加速倍率: 分为小规模数据集和大规模数据集

i. 对于小规模数据集，加速倍率不低于10倍  
ii. 对于大规模数据集，加速倍率不低于30倍

# 5.2 创新点

本课题预期将有以下创新点：

(1) 本课题提出的加速算法, 为国内首次在三维辐射场重构中使用 GPU 加速版本的反向重构算法克里金算法, 可以作为后续辐射场重构算法中的反向重构

算法加速的重要参考。同时GPU加速版本的点核积分算法的研究也较为稀少，本课题对其的加速研究也可以为后续研究提供相应参考。

(2) 相比于传统算法，本课题的算法充分利用GPU并行计算的优势，显著提高了计算效率，尤其适用于复杂的辐射场场景。  
(3) 通过在算法中引入数据并行与分块处理机制，该研究在一定程度上突破了传统方法在大规模数据处理中的瓶颈，为未来的辐射场模拟提供了新的技术手段。  
（4）该研究为辐射场重构提供了一种高效的计算方法，能够促进辐射安全评估和监测技术的发展。

# 可能遇到的困难及解决措施

# 6.1 可能遇到的困难

可能遇到的难点主要有如下几点：

(1) 未加速算法源代码获取：本课题研究专注于对原始算法的GPU加速，其必须建立在已有原始算法的基础代码的基础上。国内外已工程化且具有完备注释的开源克里金算法与点核积分算法难以寻找，在其基础上进行相应算法时间调试和加速研究具有一定难点。  
(2) 算法优化技术性问题：以第一个难点为前提，寻找到的开源算法的可扩展性不尽相同，扩展性较差的算法在执行并行化操作时会遇到很大阻碍，有可能需要直接对算法的一大部分进行重写，会对代码分析能力和编写能力带来很大挑战，同时会造成不必要的时间浪费。

# 6.2 解决措施

针对上述困难，拟采取的解决措施如下：

(1) 使用先进的代码调试技术和重构技术，对开源程序库进行详细耗时定位，同时在理解代码逻辑的同时补充注释，一步步将其耗时部分进行GPU加速。  
(2) 与课题组其他成员合作，在其代码基础上（比如点核积分）进行加速，在推动课题组其他课题的同时也能推进自己的课题。

# 为完成课题已具备和所需要的条件及经费

# 6.1 已具备条件

本人所在研究团队目前已有相关项目和经费支撑。克里金方法的加速以实现，

并在《Annals of nuclear energy》上已有一篇接收文献。

# 6.2 所需要条件

需要高性能GPU的硬件支持。