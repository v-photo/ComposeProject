"""
系统配置文件 (字典格式)
"""
import numpy as np
from typing import Dict, Any

# --- 默认配置 ---
DEFAULT_CONFIG = {
    "experiment": {
        "name": "default_adaptive_pinn",
    },
    "data": {
        "file_path": "../PINN/DATA.xlsx",
        "sheet_name_template": "avg_1_z",
        "use_columns": "B:EG",
        "z_size": 72,
        "y_size": 136,
        "space_dims": [20.0, 10.0, 10.0], # 物理空间维度 (x,y,z)
        "num_samples": 300,
        "downsample_factor": 1, # 1表示不降采样
    },
    "pinn": {
        "model_params": {
            "network_layers": [3, 64, 64, 64, 1],
            "learning_rate": 1e-3,
            "loss_ratio": 10.0,
            "num_collocation_points": 4096,
        },
        "training_params": {
            "total_epochs": 5000,
            "detect_every": 500,
            "adaptive_cycle_epochs": 2000,
        },
        "physical_params": {
            'rho': 1.2,
            'mu': 1e-3
        }
    },
    "kriging": {
        "variogram_model": "exponential",
        "nlags": 8,
        "block_size": 10000,
    },
    "selection": {
        "min_points_for_kriging": 100,
        "uniformity_cv_threshold": 0.6,
    },
    "system": {
        "use_gpu": True,
        "random_seed": 42,
        "verbose": True,
        "save_results": True,
        "checkpoint_path": "./models/pinn_checkpoint"
    }
}

# --- 预设 ---
PRESETS = {
    "default": DEFAULT_CONFIG,
    "quick_test": {
        **DEFAULT_CONFIG,
        "experiment": {"name": "quick_test"},
        "pinn": {
            **DEFAULT_CONFIG["pinn"],
            "model_params": {
                **DEFAULT_CONFIG["pinn"]["model_params"],
                "num_collocation_points": 1024,
            },
            "training_params": {
                "total_epochs": 1000,
                "detect_every": 200,
                "adaptive_cycle_epochs": 500,
            }
        },
        "data": {
            **DEFAULT_CONFIG["data"],
            "num_samples": 50,
            "test_set_size": 100,
        }
    },
    "kriging_only": {
        **DEFAULT_CONFIG,
        "experiment": {"name": "kriging_only_test"},
        "selection": {
            "min_points_for_kriging": 1,
            "uniformity_cv_threshold": 999.0, # 强制选择Kriging
        }
    },
    "pinn_only": {
        **DEFAULT_CONFIG,
        "experiment": {"name": "pinn_only_test"},
        "selection": {
            "min_points_for_kriging": 99999, # 强制选择PINN
            "uniformity_cv_threshold": 0.0,
        }
    }
}

def load_config_dict(preset_name: str = "default") -> Dict[str, Any]:
    """
    根据预设名称加载配置字典。

    Args:
        preset_name (str): 预设名称。

    Returns:
        Dict[str, Any]: 配置字典。
    """
    if preset_name not in PRESETS:
        raise ValueError(f"Unknown preset '{preset_name}'. Available presets: {list(PRESETS.keys())}")
    
    print(f"  ✅ Configuration loaded for preset: '{preset_name}'")
    return PRESETS[preset_name] 